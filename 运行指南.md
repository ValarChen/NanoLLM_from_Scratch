# 运行指南

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行单个训练实验

运行基础训练（使用示例数据快速测试）：

```bash
python -m src.train
```

或使用脚本：
- Windows: `scripts\run.bat`
- Linux/Mac: `bash scripts/run.sh`

### 3. 运行完整实验（多个配置对比）

运行所有实验配置并生成对比结果：

```bash
python -m src.experiment
```

这将运行5个不同的配置：
- baseline: 基线模型
- small_model: 小模型
- large_model: 大模型
- high_lr: 高学习率
- low_lr: 低学习率

### 4. 查看结果

训练完成后，结果保存在 `results/` 目录：

- **单个实验结果**：
  - `results/baseline/training_curves.png`: 训练曲线
  - `results/baseline/training_results.csv`: 结果表格
  - `results/baseline/training_results.md`: Markdown格式表格

- **对比结果**：
  - `results/experiment_comparison.png`: 所有实验的对比图表
  - `results/experiment_comparison.csv`: 对比表格
  - `results/experiment_comparison.md`: Markdown格式对比表格

- **报告**：
  - `results/实验报告.md`: 完整的中文实验报告

## 数据集

### 自动下载

程序会在首次运行时自动尝试下载IWSLT2017数据集。如果下载失败，会使用示例数据。

### 手动下载

如果需要手动下载数据集：

1. 访问：https://wit3.fbk.eu/archive/2017-01-trnted/texts/de/en/de-en.tgz
2. 下载并解压到 `data/` 目录
3. 确保目录结构为：`data/iwslt2017/`

## 配置说明

### 修改训练配置

编辑 `src/train.py` 中的 `main()` 函数，修改配置字典：

```python
config = {
    'd_model': 512,          # 模型维度
    'num_layers': 6,         # 层数
    'h': 8,                  # 注意力头数
    'd_ff': 2048,           # 前馈网络维度
    'dropout': 0.1,         # Dropout率
    'batch_size': 32,       # 批次大小
    'learning_rate': 1e-4,  # 学习率
    'num_epochs': 10,       # 训练轮数
    'max_samples': None,    # 限制样本数（None表示使用全部）
    'use_real_data': True,  # 是否使用真实数据集
}
```

### 快速测试配置

为了快速测试，可以使用较小的配置：

```python
config = {
    'd_model': 256,
    'num_layers': 3,
    'h': 4,
    'd_ff': 1024,
    'batch_size': 16,
    'num_epochs': 5,
    'max_samples': 1000,    # 只使用1000个样本
    'use_real_data': False, # 使用示例数据
}
```

## 常见问题

### 1. 内存不足

如果遇到内存不足：
- 减小 `batch_size`
- 减小 `max_len`
- 设置 `max_samples` 限制样本数
- 使用更小的模型（减小 `d_model`, `num_layers`, `d_ff`）

### 2. 训练速度慢

- 使用GPU：确保安装了CUDA版本的PyTorch
- 减小 `num_epochs` 进行快速测试
- 使用 `max_samples` 限制数据量

### 3. 数据集下载失败

如果数据集下载失败：
- 检查网络连接
- 手动下载数据集（见上方说明）
- 使用 `use_real_data=False` 使用示例数据

### 4. 中文显示问题

如果图表中的中文显示为方块：
- Windows: 确保系统安装了中文字体
- Linux: 安装中文字体包
- 或修改 `src/train.py` 中的字体设置

## 输出文件说明

### 训练结果文件

- `training_curves.png`: 训练和验证的损失、困惑度曲线
- `training_results.csv`: 每个epoch的详细数值
- `training_results.md`: Markdown格式的表格
- `best_model.pt`: 最佳模型检查点
- `checkpoint.pt`: 最新检查点（包含优化器状态）

### 实验对比文件

- `experiment_comparison.png`: 所有实验的对比图表
- `experiment_comparison.csv`: 对比表格
- `experiment_comparison.md`: Markdown格式对比表格

## 下一步

1. 查看 `results/实验报告.md` 了解完整的实验报告
2. 分析 `results/experiment_comparison.csv` 中的对比结果
3. 根据结果调整超参数
4. 尝试更多的实验配置

